# دليل النشر المؤقت لتطبيق ONE CLICK MARKETING على Google Cloud Run

مرحباً! هذا الدليل سيساعدك خطوة بخطوة لنشر تطبيقك (الواجهة الخلفية والواجهة الأمامية) بشكل مؤقت على Google Cloud Run. الهدف هو أن تتمكن من اختبار التطبيق بسهولة.

**الملفات التي ستحتاجها (مرفقة مع هذه الرسالة عند الانتهاء من كل شيء):

*   `backend/Dockerfile`: ملف لإعداد الواجهة الخلفية.
*   `backend/.env.example`: مثال لمتغيرات البيئة للواجهة الخلفية.
*   `frontend/Dockerfile`: ملف لإعداد الواجهة الأمامية.
*   `frontend/.env.production.example`: مثال لمتغيرات البيئة للواجهة الأمامية.
*   `gcloud_deployment_commands.md`: يحتوي على جميع أوامر `gcloud` التي ستحتاج لتنفيذها.
*   هذا الدليل (`deployment_guide_gcp.md`).

**المتطلبات الأساسية قبل البدء:**

1.  **حساب Google Cloud:** يجب أن يكون لديك حساب فعال على Google Cloud.
2.  **مشروع Google Cloud:** تحتاج إلى مشروع قائم مع تفعيل الفوترة (Billing).
3.  **أداة `gcloud` أو Cloud Shell:**
    *   إما أن تقوم بتثبيت [Google Cloud SDK (gcloud CLI)](https://cloud.google.com/sdk/docs/install) على جهازك الكمبيوتر والمصادقة عليه.
    *   أو الأسهل، يمكنك استخدام [Google Cloud Shell](https://cloud.google.com/shell/docs/launching-cloud-shell) مباشرة من متصفحك (يأتي مع `gcloud` مثبت ومصادق عليه مسبقًا).
4.  **تفعيل واجهات برمجة التطبيقات (APIs):** تأكد من تفعيل الواجهات التالية في مشروعك على Google Cloud (يمكنك البحث عنها في شريط البحث في Google Cloud Console وتفعيلها):
    *   Cloud Build API
    *   Artifact Registry API (أو Container Registry API - يُفضل Artifact Registry)
    *   Cloud Run API

--- 

**خطوات النشر:**

ستجد جميع الأوامر اللازمة في ملف `gcloud_deployment_commands.md`. اتبع الترتيب الموضح هناك.

**الخطوة 0: تجهيز الملفات ومراجعة الأوامر**

1.  قم بتنزيل جميع الملفات التي سأرفقها لك لاحقًا وضعها في مجلد واحد على جهازك، أو قم برفعها إلى بيئة Cloud Shell إذا كنت ستستخدمها.
2.  افتح ملف `gcloud_deployment_commands.md`.
3.  **مهم جداً:** قبل تنفيذ أي أمر، ستحتاج إلى استبدال جميع **العناصر النائبة (Placeholders)** الموجودة بين أقواس مربعة `[...]` بالقيم الخاصة بك. على سبيل المثال:
    *   `[YOUR_PROJECT_ID]`: بمعرف مشروعك على Google Cloud.
    *   `[YOUR_REGION]`: بالمنطقة التي تريد النشر فيها (مثلاً: `us-central1`, `europe-west1`).
    *   `[REPOSITORY_NAME]`: باسم لمستودع Docker الخاص بك (مثلاً: `oneclick-repo`).
    *   `[IMAGE_NAME_BACKEND]`: باسم لصورة Docker للواجهة الخلفية (مثلاً: `oneclick-backend`).
    *   `[SERVICE_NAME_BACKEND]`: باسم لخدمة الواجهة الخلفية على Cloud Run (مثلاً: `oneclick-backend-service`).
    *   وبالمثل للواجهة الأمامية.
    *   **متغيرات البيئة:** ستحتاج أيضًا إلى استبدال جميع قيم `YOUR_..._HERE` في أوامر `gcloud run deploy ... --set-env-vars` بالقيم الحقيقية الخاصة بك (مثل مفاتيح API، كلمات المرور، إلخ). يمكنك الرجوع إلى ملفي `.env.example` و `.env.production.example` كمرجع لهذه المتغيرات.

**الخطوة 1: نشر الواجهة الخلفية (Flask)**

1.  اتبع التعليمات الموجودة في `gcloud_deployment_commands.md` تحت قسم `Part 1: Deploy Backend (Flask Application)`.
2.  نفذ الأوامر بالترتيب.
3.  بعد تنفيذ أمر `gcloud run deploy [SERVICE_NAME_BACKEND] ...` بنجاح، سيقوم Cloud Run بتزويدك **بعنوان URL لخدمة الواجهة الخلفية**. احتفظ بهذا العنوان، ستحتاجه للخطوة التالية.
    *   مثال للعنوان: `https://oneclick-backend-service-abcdef123-uc.a.run.app`

**الخطوة 2: نشر الواجهة الأمامية (Next.js)**

1.  اتبع التعليمات الموجودة في `gcloud_deployment_commands.md` تحت قسم `Part 2: Deploy Frontend (Next.js Application)`.
2.  **مهم:** قبل تنفيذ أمر `gcloud run deploy [SERVICE_NAME_FRONTEND] ...`، تأكد من استبدال `[URL_OF_YOUR_DEPLOYED_BACKEND_SERVICE]` في متغير البيئة `NEXT_PUBLIC_API_BASE_URL` بعنوان URL الفعلي للواجهة الخلفية الذي حصلت عليه في الخطوة السابقة.
3.  نفذ الأوامر بالترتيب.
4.  بعد التنفيذ بنجاح، سيقوم Cloud Run بتزويدك **بعنوان URL لخدمة الواجهة الأمامية**. هذا هو العنوان الرئيسي الذي ستستخدمه للوصول إلى تطبيقك.

**الخطوة 3: تحديث الواجهة الخلفية بعنوان الواجهة الأمامية (إذا لزم الأمر)**

1.  في بعض الحالات، قد تحتاج الواجهة الخلفية لمعرفة عنوان الواجهة الأمامية (مثلاً لإعدادات CORS).
2.  اتبع التعليمات في `gcloud_deployment_commands.md` تحت قسم `Part 3: Update Backend with Frontend URL (if necessary)` لتحديث متغير البيئة `FRONTEND_URL` في خدمة الواجهة الخلفية.

**الخطوة 4: الوصول إلى التطبيق**

*   استخدم عنوان URL الخاص بخدمة الواجهة الأمامية الذي حصلت عليه من Cloud Run للوصول إلى تطبيق ONE CLICK MARKETING عبر المتصفح.

--- 

**اعتبارات هامة للنشر المؤقت:**

*   **قاعدة البيانات:** هذا الدليل يفترض أن قاعدة بياناتك (MySQL) مُعدة بالفعل ويمكن الوصول إليها من Google Cloud Run (مثلاً، Cloud SQL مع IP عام/خاص، أو قاعدة بيانات مستضافة خارجيًا). إذا كنت بحاجة لإعداد قاعدة بيانات مؤقتة على Google Cloud، فهذه ستكون خطوات إضافية.
*   **إيقاف/حذف الخدمات (لتجنب التكاليف):** بما أنه نشر مؤقت، تذكر إيقاف أو حذف الخدمات عند الانتهاء من الاختبار لتجنب استمرار التكاليف:
    *   لحذف الخدمات: استخدم الأوامر المذكورة في نهاية ملف `gcloud_deployment_commands.md`.
    *   أو يمكنك حذف المشروع بأكمله إذا كان مخصصًا لهذا الغرض فقط.
*   **الأمان:** تم استخدام العلامة `--allow-unauthenticated` لجعل الخدمات متاحة للعامة بسهولة للاختبار. في بيئة الإنتاج الحقيقية، ستحتاج إلى تطبيق آليات مصادقة مناسبة.
*   **متغيرات البيئة الحساسة:** للقيم الحساسة (مثل كلمات مرور قاعدة البيانات، مفاتيح API)، يُفضل في بيئة الإنتاج استخدام Google Cloud Secret Manager بدلاً من تعيينها مباشرة في أمر النشر.

--- 

سأقوم الآن بتجميع كل هذه الملفات وإرسالها لك. إذا واجهتك أي صعوبات أثناء تنفيذ هذه الخطوات، فلا تتردد في سؤالي!
