# ONE CLICK MARKETING - دليل النشر على Vercel

## مقدمة

سيساعدك هذا الدليل على نشر تطبيق "ONE CLICK MARKETING" (الواجهة الأمامية Next.js والواجهة الخلفية Flask) على منصة Vercel. نفترض أن لديك حسابًا على Vercel وأن كود مشروعك موجود في مستودع Git (مثل GitHub، GitLab، أو Bitbucket).

## المتطلبات الأساسية:

1.  حساب Vercel فعال.
2.  كود مشروعك مرفوع إلى مستودع Git (يُفضل GitHub للتكامل السلس مع Vercel).
3.  ملف `vercel.json` (الذي قمت بإعداده مسبقًا) موجود في المجلد الجذر لمشروعك.
4.  تطبيق Flask الخلفي مهيأ للعمل كدالة بدون خادم (Serverless Function) (وهو ما قمت بمراجعته).
5.  ملف `requirements.txt` للواجهة الخلفية، موجود في المسار `backend/requirements.txt`.

## خطوات النشر:

### الخطوة 1: استيراد مشروعك إلى Vercel

1.  سجّل الدخول إلى لوحة تحكم Vercel الخاصة بك.
2.  انقر على "Add New..." ثم اختر "Project".
3.  قم بربط Vercel بمزود Git الخاص بك (مثل GitHub) إذا لم تكن قد فعلت ذلك من قبل.
4.  اختر المستودع الذي يحتوي على مشروع "ONE CLICK MARKETING".
5.  سيقوم Vercel تلقائيًا بالتعرف عليه كمشروع Next.js.

### الخطوة 2: ضبط إعدادات المشروع

من المفترض أن يتعرف Vercel تلقائيًا على الواجهة الأمامية Next.js. سيساعد ملف `vercel.json` منصة Vercel على فهم كيفية التعامل مع الواجهة الخلفية المكتوبة بلغة Python.

1.  **Framework Preset (الإعداد المسبق للإطار):** يجب أن يتم تعيينه تلقائيًا إلى "Next.js".
2.  **Root Directory (المجلد الجذر):**
    *   بما أن ملف `vercel.json` موجود في جذر المستودع، ويشير إلى `frontend/package.json` لبناء Next.js وإلى `backend/src/main.py` للواجهة الخلفية، فإن Vercel يجب أن يتعامل مع هذا الهيكل بشكل صحيح. لا تحتاج عادةً إلى تغيير المجلد الجذر إذا كان `vercel.json` مهيأً بشكل صحيح للإشارة إلى مسارات البناء الصحيحة داخل المشروع.
3.  **Build and Output Settings (إعدادات البناء والمخرجات):**
    *   سيستخدم Vercel أمر البناء من ملف `frontend/package.json` (وهو `next build`).
    *   مجلد المخرجات عادةً ما يكون `.next` لتطبيقات Next.js، وهو ما يتعامل معه Vercel.
    *   بالنسبة للواجهة الخلفية Python، يحدد `vercel.json` استخدام `@vercel/python` ويشير إلى `backend/src/main.py`. تأكد من أن ملف `backend/requirements.txt` موجود ويحتوي على جميع الاعتماديات اللازمة.

### الخطوة 3: ضبط متغيرات البيئة (Environment Variables)

هذه خطوة حاسمة لكي تعمل كل من الواجهة الأمامية والخلفية بشكل صحيح.
1.  في إعدادات مشروعك على Vercel، انتقل إلى "Settings" ثم "Environment Variables".
2.  أضف متغيرات البيئة التالية:

    *   **للواجهة الأمامية Next.js (مستخدمة في `frontend/.env.production.example`):**
        *   `NEXT_PUBLIC_API_BASE_URL`: يجب أن يكون هذا هو المسار النسبي لواجهة برمجة تطبيقات الخلفية. نظرًا لأن الواجهة الخلفية ستكون متاحة عبر نفس نطاق الواجهة الأمامية ولكن تحت المسار `/api` (بفضل قاعدة إعادة الكتابة في `vercel.json`), قم بتعيين هذا المتغير إلى `/api`.
            *   مثال: `NEXT_PUBLIC_API_BASE_URL` = `/api`

    *   **للواجهة الخلفية Flask (مستخدمة في `backend/.env.example` و `backend/src/main.py`):**
        *   `SECRET_KEY`: مفتاح سري قوي وعشوائي لإدارة جلسات Flask وميزات الأمان الأخرى. قم بإنشاء واحد (على سبيل المثال، باستخدام مولد كلمات مرور).
        *   `DB_HOST`: (إذا كنت تستخدم قاعدة بيانات) اسم مضيف خادم قاعدة البيانات الخاصة بك.
        *   `DB_NAME`: (إذا كنت تستخدم قاعدة بيانات) اسم قاعدة البيانات الخاصة بك.
        *   `DB_USER`: (إذا كنت تستخدم قاعدة بيانات) اسم المستخدم للوصول إلى قاعدة البيانات.
        *   `DB_PASSWORD`: (إذا كنت تستخدم قاعدة بيانات) كلمة المرور لمستخدم قاعدة البيانات.
        *   `DB_PORT`: (إذا كنت تستخدم قاعدة بيانات) منفذ قاعدة البيانات الخاصة بك (مثل 3306 لـ MySQL).
        *   *أي متغيرات بيئة أخرى يتطلبها تطبيقك الخلفي.*

    *ملاحظة هامة:* بالنسبة لأي متغيرات خاصة بالواجهة الخلفية Python ولا ينبغي كشفها لعملية بناء الواجهة الأمامية، فإن Vercel يسمح لك بتحديد مدى توفرها. بشكل افتراضي، تكون متاحة لجميع "Serverless Functions" (والتي ستكون عليها الواجهة الخلفية Python).

### الخطوة 4: النشر (Deploy)

1.  بعد ضبط متغيرات البيئة، انقر على زر "Deploy".
2.  سيقوم Vercel بجلب الكود الخاص بك، وبناء الواجهة الأمامية، وإعداد دالة Python بدون خادم للواجهة الخلفية، ثم نشر تطبيقك.
3.  يمكنك مراقبة سجلات البناء في لوحة تحكم Vercel.

### الخطوة 5: الوصول إلى تطبيقك المنشور

1.  بمجرد نجاح عملية النشر، سيوفر لك Vercel عنوان URL واحدًا أو أكثر (مثل `your-project-name.vercel.app`).
2.  ستكون واجهتك الأمامية Next.js متاحة على عنوان URL الرئيسي.
3.  ستكون نقاط نهاية واجهة برمجة تطبيقات Flask الخلفية متاحة تحت المسار `/api/` (على سبيل المثال، `https://your-project-name.vercel.app/api/auth/login`). هذا بفضل قاعدة إعادة الكتابة `{ "source": "/api/(.*)", "destination": "/backend/src/main.py" }` في ملف `vercel.json`.

## استكشاف الأخطاء وإصلاحها:

*   **فشل البناء:** تحقق من سجلات البناء على Vercel. تشمل المشكلات الشائعة الاعتماديات المفقودة (تأكد من أن `frontend/package.json` و `backend/requirements.txt` صحيحة ومرفوعة إلى المستودع)، أو أوامر بناء غير صحيحة (على الرغم من أن Vercel عادةً ما يكتشف Next.js و Python بشكل صحيح مع وجود `vercel.json`).
*   **أخطاء وقت التشغيل:** تحقق من سجلات "Functions" في لوحة تحكم مشروعك على Vercel بحثًا عن الأخطاء المتعلقة بواجهتك الخلفية Flask. بالنسبة لأخطاء الواجهة الأمامية، استخدم وحدة تحكم المطور في المتصفح.
*   **متغيرات البيئة:** تحقق مرة أخرى من أن جميع متغيرات البيئة المطلوبة قد تم تعيينها بشكل صحيح في Vercel وأن تطبيقك يستخدمها.
*   **إصدار Python:** يحدد `vercel.json` استخدام Python 3.9. تأكد من أن الاعتماديات في `backend/requirements.txt` متوافقة مع هذا الإصدار.

## تحديث تطبيقك:

ما عليك سوى دفع تغييراتك إلى فرع Git المتصل (عادةً `main` أو `master`). سيقوم Vercel تلقائيًا باكتشاف التغييرات وإعادة نشر تطبيقك.

هذا الدليل يجب أن يوفر لك أساسًا متينًا لنشر تطبيقك. أخبرني إذا كانت لديك أي أسئلة أثناء العملية!

